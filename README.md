# 简介

email: zry123@mail.ustc.edu.cn
本软件包用于对第四版TPC的测试数据进行分析，TPC使用aget电子学，也可以用于NTD_Ge_new_version模拟程序产生的TPC模拟数据的分析，使用方法如下：

## 1. 解包
对于测试得到的原始.dat文件，首先使用Raw2root将其转化为原始root文件（记为f1），f1存储在Raw2root目录下，保存了完整的数据信息，后续程序均在此root文件基础上进行（模拟输出数据的格式也为此root文件）。

## 1.5. 计算基线
（仅针对测试）对于每次测试，需要先进行一次自触发采数，得到该次测试的基线。在测试时使用自触发模式采集得到的数据，经过解包后，使用Pedestal进行基线计算，该程序使用一个特定的事例的所有通道计算均值和标准差，得到基线，输出至Calibration目录下，具体的基线格式在生成后还需手动略作修改，参照已经上传的其它基线文件。之后，需要将后续分析程序，主要是Hitsmap和ConstructTree，中对应位置的基线文件名改为实际使用的基线：
```
char pedestaldata[80] ="./Calibration/20240131101736659_baseline_25MHz_500ns_1pC_pedestal.txt";
// char pedestaldata[80] = "./Calibration/simulation_baseline.txt";
```
`simulation_baseline.txt`是针对模拟数据的基线，由于模拟输出波形基线为0。处理数据时分情况使用合适的基线文件。

## 2. 作图

使用Hitsmap程序，以f1文件为输入，作用是在一系列筛选条件后得到一些特征分布，并以直方图形式画出，同时会保存前100个事例的径迹、能量沉积，输出保存在Hitsmap目录

## 3. 数据预处理

使用ConstructTree程序，以f1文件为输入，作用是将原始数据经一系列筛选后得到一部分剩余事例，并计算和保存这些剩余事例的特征（以Tree的形式）至VariableTree目录下的另一个root文件中（记为f2），该文件作为后续信号-本底区分的输入文件。

## 4. 区分模型训练

此步骤以两个f2文件为输入，分别为信号和本底的，还需要一个参数为检验量的cut值（无实际作用），可选的程序有Train和TMVATrain两个，前者为似然比方法，后者为BDT方法，二者均可使用，视情况而定。

## 5. 事例区分

此步骤以一个f2文件为输入，另一个参数为设置的检验量cut值，检验量大于该值的事例会被认为是信号。可选的程序有Analysis和TMVAAnalysis两个，前者为似然比方法，后者为BDT方法，分别需要读入上一步相应方法产生的训练输出文件，程序会输出认为是信号的事例数的比例和数目，并将剩余事例的一些特征作图保存在AnalysisResult目录下，此外还会将所有剩余事例的变量仍然以Tree的格式保存在VariableTree目录下一个新的文件中，后缀有`_selected`，以便有二次区分的需要。

## 注意：上述需要的一些输出文件的目录在git上并不存在，需要自行创建，否则可能无法运行

-----
## 2024.2.26 更新说明

- 新增了一个TrackFind.h文件，用于在画XZ和YZ径迹图时重新规划连线顺序，同时用于计算连先后的径迹长度
- 对任意径迹图，连线方法为：首先以最上方的点，即Z最大的点为起点，在剩余点中找出与当前点距离最近的点，将其与当前点连起来，然后以这个新的连接点为起点，继续找寻还未连接的点，以此类推，直到用完所有点（距离单位为mm，在横轴上根据条间距转换，在纵轴上根据漂移速度3.5cm/us转换得到）
- 径迹长度定义：按上述方法连线过程中每两个点间的距离累加得到XZ/YZ维的径迹长度
- 对应的将Hitsmap.C和ConstructTree.C进行了更新
- 现在XZ和YZ维的径迹长度作为新的变量加入，可用于多变量区分
